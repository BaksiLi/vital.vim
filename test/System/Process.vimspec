scriptencoding utf-8

let s:V = vital#of('vital')
let s:Prelude = s:V.import('Prelude')

Describe System.Process
  Before
    let Process = s:V.import('System.Process')
  End

  Describe .execute({args}, {options})
    " NOTE:
    " Tests for actual process call are in System/Process/XXXXX.vimspec
    It uses a String item in {options.clients} as a process client
      let args = s:Prelude.is_windows()
            \ ? ['cmd', '/C', 'exit 0']
            \ : ['true']
      let result = Process.execute(args, {
            \ 'clients': ['System.Process.System'],
            \})
      Assert Equals(result.success, 1)
      Assert Equals(result.output, '')
    End

    It uses a Dictionary item in {options.clients} as a process client
      let Mock = s:V.import('System.Process.Mock')
      let result = Process.execute(['foo', 'bar'], {
            \ 'clients': [Mock],
            \})
      Assert Equals(result.success, 1)
      Assert Equals(result.output, 'Output of System.Process.Mock')
    End
  End
End
